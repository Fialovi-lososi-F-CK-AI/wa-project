name: ci_backend_dev

on:
  pull_request:
    branches:
      - main
    paths:
      - 'src/backend/**'

jobs:
  backend:
    name: Backend CI
    runs-on: [self-hosted]
    defaults:
      run:
        working-directory: src/backend
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: 8.2
          extensions: mbstring, intl, pdo_mysql, xdebug
          ini-file: production
          allow-sudo: false

      - name: Install dependencies
        run: composer install --no-progress --no-interaction

      - name: Run PHPStan (static analysis)
        run: vendor/bin/phpstan analyse .

      - name: Run Symfony tests
        run: vendor/bin/phpunit